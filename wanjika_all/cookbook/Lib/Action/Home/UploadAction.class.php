<?phpclass UploadAction extends CommAction {//手机版上传菜谱封面	public function uploadimg(){		 if($this->ispost()){			import('Class.UploadFile',LIB_PATH);			$upload = new UploadFile();// 实例化上传类             $res["error"] = "";//错误信息             $res["msg"] = "上传成功";//提示信息			$upload->maxSize  = C('MAX_SIZE');// 设置附件上传大小			$upload->allowExts  = explode(',',C('FIEL_NAME'));// 设置附件上传类型			//$upload->autoSub = true;			//$upload->subType = 'date';			//$upload->dateFormat = 'Ymd';			$upload->savePath = APP_PATH.'Uploads/recipe/';// 设置附件上传目录			   $upload->thumb = C('IS_thumb');				// 设置引用图片类库包路径				$upload->imageClassPath ='@.Class.Image';				//设置需要生成缩略图的文件后缀				$upload->thumbPrefix = 'm_';  //生产2张缩略图				//设置缩略图最大宽度				$upload->thumbMaxWidth = C('thumbMaxWidth');				//设置缩略图最大高度				$upload->thumbMaxHeight = C('thumbMaxHeight');				$upload->saveRule = uniqid;				$upload->thumbRemoveOrigin = true;			 if(!$upload->upload()) {// 上传错误提示错误信息                 $res["error"] = $upload->getErrorMsg();                 echo json_encode($res);exit;			 }else{// 上传成功 获取上传文件信息				$info =  $upload->getUploadFileInfo();				if(C('IS_thumb')){					$m='m_';				}				$picurl=__ROOT__.str_replace('.','',$info[0]['savepath']).$m.$info[0]['savename'];				//$picurl=$info[0]['savepath'].'m_'.$info[0]['savename'];				//echo "<script type='text/javascript'>parent.document.getElementById('logo').value='".$picurl."';</script>";                 $res['msg']=$picurl;                 echo json_encode($res);exit;				//$this->success('上传成功');		 }		}else{			$this->display();			}}    public function uploadimgc(){        $base64 = I('post.str');        if (preg_match('/^(data:\s*image\/(\w+);base64,)/', $base64, $result)){            $type = $result[2];            $new_file = APP_PATH.'Uploads/recipe/'.time().".jpg";            if (file_put_contents($new_file, base64_decode(str_replace($result[1], '', $base64)))){                $str=preg_replace('/./','',$new_file,1);                echo $str;            }        }    }}